<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake - The Webcade</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P:wght@400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <button id="backBtn" class="back-btn">‚Üê Back to Arcade</button>
            <div class="game-info">
                <span class="score">Score: <span id="scoreValue">0</span></span>
                <span class="score">High: <span id="highScoreValue">0</span></span>
                <span class="level">Length: <span id="lengthValue">1</span></span>
            </div>
        </div>
        
        <canvas id="gameCanvas" class="game-canvas" width="800" height="600"></canvas>
        
        <div class="controls-info" style="margin-top: 20px; text-align: center; font-size: 10px; color: #cccccc;">
            <p>Use arrow keys or WASD to move ‚Ä¢ Space to pause</p>
            <p>Mobile: Swipe to change direction</p>
        </div>
    </div>

    <div id="gameOver" class="game-over hidden">
        <h2>Game Over!</h2>
        <p>Score: <span id="finalScore">0</span></p>
        <p id="newHighScore" style="color: #ffff00; display: none;">üéâ New High Score! üéâ</p>
        <button id="restartBtn" class="restart-btn">Play Again</button>
        <button id="homeBtn" class="restart-btn">Back to Arcade</button>
    </div>

    <script src="gameBase.js"></script>
    <script src="main.js"></script>
    <script>
        class SnakeGame extends GameBase {
            constructor() {
                super('gameCanvas', 'snake');
                this.gridSize = 20;
                this.tileCount = this.canvas.width / this.gridSize;
                this.init();
                this.gameLoop();
            }

            init() {
                this.snake = [
                    { x: 10, y: 10 }
                ];
                this.food = this.generateFood();
                this.dx = 0;
                this.dy = 0;
                this.score = 0;
                this.gameOver = false;
                
                // Update high score display
                document.getElementById('highScoreValue').textContent = this.highScore;
                
                this.attachEventListeners();
            }

            attachEventListeners() {
                // Keyboard controls
                document.addEventListener('keydown', (e) => {
                    if (this.gameOver || this.paused) return;
                    
                    switch(e.code) {
                        case 'ArrowUp':
                        case 'KeyW':
                            if (this.dy === 0) {
                                this.dx = 0;
                                this.dy = -1;
                            }
                            break;
                        case 'ArrowDown':
                        case 'KeyS':
                            if (this.dy === 0) {
                                this.dx = 0;
                                this.dy = 1;
                            }
                            break;
                        case 'ArrowLeft':
                        case 'KeyA':
                            if (this.dx === 0) {
                                this.dx = -1;
                                this.dy = 0;
                            }
                            break;
                        case 'ArrowRight':
                        case 'KeyD':
                            if (this.dx === 0) {
                                this.dx = 1;
                                this.dy = 0;
                            }
                            break;
                    }
                });

                // Touch controls for mobile
                let startX, startY;
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                });

                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (!startX || !startY || this.gameOver || this.paused) return;

                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;
                    const diffX = startX - endX;
                    const diffY = startY - endY;

                    if (Math.abs(diffX) > Math.abs(diffY)) {
                        if (diffX > 0 && this.dx === 0) {
                            this.dx = -1;
                            this.dy = 0;
                        } else if (diffX < 0 && this.dx === 0) {
                            this.dx = 1;
                            this.dy = 0;
                        }
                    } else {
                        if (diffY > 0 && this.dy === 0) {
                            this.dx = 0;
                            this.dy = -1;
                        } else if (diffY < 0 && this.dy === 0) {
                            this.dx = 0;
                            this.dy = 1;
                        }
                    }
                });
            }

            generateFood() {
                let food;
                do {
                    food = {
                        x: Math.floor(Math.random() * (this.canvas.width / this.gridSize)),
                        y: Math.floor(Math.random() * (this.canvas.height / this.gridSize))
                    };
                } while (this.snake.some(segment => segment.x === food.x && segment.y === food.y));
                
                return food;
            }

            update() {
                if (this.gameOver || this.paused) return;

                // Don't move if no direction is set
                if (this.dx === 0 && this.dy === 0) return;

                const head = { x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy };

                // Check wall collision
                if (head.x < 0 || head.x >= this.canvas.width / this.gridSize ||
                    head.y < 0 || head.y >= this.canvas.height / this.gridSize) {
                    this.endGame();
                    return;
                }

                // Check self collision
                if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    this.endGame();
                    return;
                }

                this.snake.unshift(head);

                // Check food collision
                if (head.x === this.food.x && head.y === this.food.y) {
                    this.score += 10;
                    this.updateScore(this.score);
                    document.getElementById('lengthValue').textContent = this.snake.length;
                    this.food = this.generateFood();
                    WebcadeUtils.playSound(880, 0.1);
                } else {
                    this.snake.pop();
                }
            }

            draw() {
                // Clear canvas
                this.ctx.fillStyle = '#0a0a0a';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw snake
                this.ctx.fillStyle = '#00ffff';
                this.ctx.shadowBlur = 10;
                this.ctx.shadowColor = '#00ffff';
                
                this.snake.forEach((segment, index) => {
                    if (index === 0) {
                        // Snake head
                        this.ctx.fillStyle = '#00ff00';
                        this.ctx.shadowColor = '#00ff00';
                    } else {
                        this.ctx.fillStyle = '#00ffff';
                        this.ctx.shadowColor = '#00ffff';
                    }
                    
                    this.ctx.fillRect(
                        segment.x * this.gridSize + 2,
                        segment.y * this.gridSize + 2,
                        this.gridSize - 4,
                        this.gridSize - 4
                    );
                });

                // Draw food
                this.ctx.fillStyle = '#ff00ff';
                this.ctx.shadowColor = '#ff00ff';
                this.ctx.fillRect(
                    this.food.x * this.gridSize + 2,
                    this.food.y * this.gridSize + 2,
                    this.gridSize - 4,
                    this.gridSize - 4
                );

                this.ctx.shadowBlur = 0;

                // Draw pause screen if paused
                if (this.paused) {
                    this.drawPauseScreen();
                }
            }

            endGame() {
                this.gameOver = true;
                this.showGameOver();
            }

            restart() {
                this.init();
            }

            gameLoop() {
                this.update();
                this.draw();
                setTimeout(() => this.gameLoop(), 100);
            }
        }

        // Start the game
        document.addEventListener('DOMContentLoaded', () => {
            new SnakeGame();
        });
    </script>
</body>
</html>